<!DOCTYPE html>
<html>
<head>
<title>Space</title>
<link rel="stylesheet" type="text/css" href="stylesheet.css">
<!--https://www.npmjs.com/package/device-capabilities.js-->
<!-- normalises gyro https://www.npmjs.com/package/gyronorm -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.5.0/css/swiper.min.css">
<script type="text/javascript" src="paper-full.min.js"></script>
<!-- Define inlined JavaScript -->
    <script type="text/javascript">
        // Only executed our code once the DOM is ready.
        window.onload = function() {
            // Get a reference to the canvas object
            var canvas = document.getElementById('myCanvas');
            // Create an empty project and a view for the canvas:
            paper.setup(canvas);

            var myPath = new paper.Path();
            myPath.strokeColor = 'black';

            // Draw the view now:
            paper.view.draw();

            var tool = new paper.Tool();

            /*tool.onMouseDown = function(event) {
              console.log("here");
                myPath.add(event.point);
            }*/

            function handleOrientation(event) {

              var p = event.absolute;
              var x = event.beta;  // In degree in the range [-180,180]
              var y = event.gamma; // In degree in the range [-90,90]
              var z = event.alpha;
              var webkit = event.webkitCompassHeading;
              var accuracy = event.webkitCompassAccuracy;
              var mag = event.magnetometer

              // Because we don't want to have the device upside down
              // We constrain the x value to the range [-90,90]
              //if (x >  90) { x =  90};
              //if (x < -90) { x = -90};

              // To make computation easier we shift the range of
              // x and y to [0,180]
              x += 90;
              y += 90;

              // 10 is half the size of the ball
              // It center the positioning point to the center of the ball
              /*ball.style.top  = (maxX*x/180 - 10) + "px";
              ball.style.left = (maxY*y/180 - 10) + "px";*/
              myPath.add(x, y);
              console.log('here: ' + x + " " + y);
            }
            window.addEventListener('deviceorientation', handleOrientation);

        }
    </script>

</head>
<body>
<canvas id="myCanvas" resize>
  <!-- Slider main container -->
  <!-- Slider main container -->
  <div class="swiper-container">
  <div class="swiper-wrapper">
    <div class="swiper-slide">

      <!--  <div class="garden">
          <div class="ball"></div>
        </div>-->

</div>
    <div id="2" class="swiper-slide">Slide 2</div>
    <div id="3" class="swiper-slide swiper-no-swiping">
      <p> </p>
    </div>
    <div id="4" class="swiper-slide">Slide 4</div>
    <div class="swiper-slide">Slide 5</div>
    <div class="swiper-slide">Slide 6</div>
    <div class="swiper-slide">Slide 7</div>
    <div class="swiper-slide">Slide 8</div>
    <div class="swiper-slide">Slide 9</div>
    <div class="swiper-slide">Slide 10</div>
  </div>
</div>
<!--
<pre class="output"></pre>
<pre class="output2"></pre>
<script src="javascript.js"></script>-->

<script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.5.0/js/swiper.min.js"></script>

<!-- Initialize Swiper -->
<script>
  var north = 0;
  var noNorth = 0;
  var swiper = new Swiper('.swiper-container');
  // Get event data
  swiper.on( 'slideChange', function() {
    if (swiper.realIndex == 2) {
      function deviceOrientationListener(event) {
        var alpha    = event.alpha; //z axis rotation [0,360)
        var beta     = event.beta; //x axis rotation [-180, 180]
        var gamma    = event.gamma; //y axis rotation [-90, 90]
        //Check if absolute values have been sent
        if (typeof event.webkitCompassHeading !== "undefined") {
          alpha = event.webkitCompassHeading; //iOS non-standard
          var heading = alpha;
          document.getElementById("3").innerHTML = heading.toFixed([0]);
        }
        else {

          var heading = 360 - alpha; //heading [0, 360)
          document.getElementById("3").innerHTML = heading.toFixed([0]);
        }

        // Change backgroud colour based on heading
        // Green for North and South, black otherwise
        if (heading > 359 || heading < 1) { //Allow +- 1 degree
          document.getElementById("3").style = "green";
          document.getElementById("3").innerHTML = "N"; // North
          navigator.vibrate([200, 400, 200]);

            north = 1;


        }
        else if (heading > 179 && heading < 181){ //Allow +- 1 degree
          document.getElementById("3").style = "green";
          document.getElementById("3").innerHTML = "S"; // South
          north = 1;
          swiper.slideTo(3, 100)
        }
    else { // Otherwise, use near black
       document.body.style.backgroundColor = "#161616";
     }
    }

    // Check if device can provide absolute orientation data
    if (window.DeviceOrientationAbsoluteEvent) {
     window.addEventListener("DeviceOrientationAbsoluteEvent", deviceOrientationListener);
    } // If not, check if the device sends any orientation data
    else if(window.DeviceOrientationEvent){
     window.addEventListener("deviceorientation", deviceOrientationListener);
    } // Send an alert if the device isn't compatible
    else {
     alert("Sorry, try again on a compatible mobile device!");
    }

    }
  });


</script>
  </canvas>
</body>
</html>
